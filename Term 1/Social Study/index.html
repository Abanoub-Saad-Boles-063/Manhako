<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الدراسات الاجتماعية - منهجكو</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&family=Orbitron:wght@400;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="../../styles/futuristic.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        /* Header */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: rgba(5, 5, 16, 0.9);
            backdrop-filter: blur(30px);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(0, 240, 255, 0.15);
        }

        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            text-decoration: none;
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(0, 240, 255, 0.1);
            border: 1px solid rgba(0, 240, 255, 0.3);
            color: var(--primary);
            padding: 0.6rem 1.2rem;
            border-radius: 10px;
            text-decoration: none;
            font-family: 'Cairo';
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: var(--primary);
            color: var(--bg-dark);
        }

        .menu-btn {
            background: rgba(0, 240, 255, 0.1);
            border: 1px solid rgba(0, 240, 255, 0.3);
            color: var(--primary);
            padding: 0.6rem 1.2rem;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Cairo';
            font-size: 1rem;
            transition: all 0.3s;
        }

        .menu-btn:hover {
            background: var(--primary);
            color: var(--bg-dark);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            right: -380px;
            width: 380px;
            height: 100vh;
            background: rgba(5, 5, 16, 0.98);
            backdrop-filter: blur(30px);
            z-index: 200;
            transition: right 0.4s ease;
            padding: 2rem 1rem;
            border-left: 1px solid var(--primary);
            overflow-y: auto;
        }

        .sidebar.active {
            right: 0;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(0, 240, 255, 0.3);
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 2rem;
            cursor: pointer;
        }

        .chapter-title {
            color: var(--secondary);
            font-size: 1rem;
            font-weight: 700;
            margin: 1.5rem 0 0.5rem;
            padding: 0.8rem;
            background: rgba(255, 0, 234, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .lesson-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.8rem 1rem;
            margin: 0.3rem 0;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid transparent;
            border-radius: 10px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .lesson-item:hover,
        .lesson-item.active {
            border-color: var(--primary);
            background: rgba(0, 240, 255, 0.1);
            transform: translateX(-5px);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 150;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Main */
        main {
            position: relative;
            z-index: 1;
            padding: 100px 2rem 2rem;
            max-width: 1100px;
            margin: 0 auto;
        }

        /* Welcome */
        .welcome {
            text-align: center;
            padding: 4rem 2rem;
        }

        .welcome h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .welcome p {
            color: var(--text-muted);
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .feature {
            padding: 1.5rem;
            text-align: center;
        }

        .feature i {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* 3D Map */
        .map-3d-container {
            perspective: 1500px;
            margin: 2rem 0;
        }

        .map-3d {
            background: linear-gradient(135deg, rgba(0, 100, 200, 0.3), rgba(0, 200, 100, 0.2));
            border-radius: 20px;
            padding: 2rem;
            transform-style: preserve-3d;
            transition: transform 0.5s;
            border: 2px solid rgba(0, 240, 255, 0.3);
            position: relative;
        }

        .map-3d:hover {
            transform: rotateX(5deg) rotateY(-5deg);
        }

        .map-3d h3 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 1.4rem;
        }

        .egypt-map {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            max-width: 500px;
            margin: 0 auto;
        }

        .map-region {
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            transform-style: preserve-3d;
        }

        .map-region:hover {
            transform: translateZ(20px) scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .region-north {
            background: rgba(0, 200, 255, 0.4);
        }

        .region-west {
            background: rgba(255, 200, 0, 0.4);
        }

        .region-center {
            background: linear-gradient(135deg, #ffd700, #00ff88);
            font-weight: 700;
        }

        .region-east {
            background: rgba(255, 100, 100, 0.4);
        }

        .region-south {
            background: rgba(100, 255, 100, 0.4);
        }

        .map-info-panel {
            background: rgba(0, 240, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            display: none;
        }

        .map-info-panel.active {
            display: block;
        }

        /* Flashcards */
        .flashcard-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            margin: 2rem 0;
        }

        .flashcard {
            width: 100%;
            max-width: 500px;
            height: 280px;
            perspective: 1000px;
            cursor: pointer;
        }

        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }

        .flashcard-front,
        .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .flashcard-front {
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.2), rgba(255, 0, 234, 0.1));
            border: 2px solid var(--primary);
        }

        .flashcard-back {
            background: linear-gradient(135deg, rgba(255, 0, 234, 0.2), rgba(0, 240, 255, 0.1));
            border: 2px solid var(--secondary);
            transform: rotateY(180deg);
        }

        .flashcard-front h3 {
            font-size: 1.3rem;
            color: var(--primary);
            text-align: center;
        }

        .flashcard-back p {
            font-size: 1.1rem;
            text-align: center;
            line-height: 1.8;
        }

        .flashcard-controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .flashcard-btn {
            background: rgba(0, 240, 255, 0.1);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Cairo';
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .flashcard-btn:hover {
            background: var(--primary);
            color: var(--bg-dark);
        }

        .flashcard-btn.correct {
            border-color: var(--accent);
            color: var(--accent);
        }

        .flashcard-btn.wrong {
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .progress-bar {
            width: 100%;
            max-width: 500px;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s;
        }

        /* Card Styles */
        .card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 240, 255, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .card-title {
            color: var(--primary);
            font-size: 1.2rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .lesson-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .lesson-header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .lesson-header h2 {
            color: var(--text-muted);
            font-weight: normal;
            font-size: 1rem;
        }

        /* PDF Links */
        .pdf-link {
            display: block;
            padding: 1rem;
            background: rgba(0, 240, 255, 0.1);
            border: 1px solid rgba(0, 240, 255, 0.3);
            border-radius: 10px;
            color: var(--text);
            text-decoration: none;
            transition: all 0.3s;
            margin-bottom: 0.8rem;
        }

        .pdf-link:hover {
            transform: translateX(-5px);
            background: rgba(0, 240, 255, 0.2);
            border-color: var(--primary);
        }

        .pdf-link i {
            margin-left: 0.5rem;
            color: var(--primary);
        }

        /* Mobile */
        @media (max-width: 768px) {
            header {
                padding: 0.8rem 1rem;
            }

            .logo {
                font-size: 1.1rem;
            }

            main {
                padding: 80px 1rem 1rem;
            }

            .sidebar {
                width: 100%;
                right: -100%;
            }

            .welcome h1 {
                font-size: 2rem;
            }

            .flashcard {
                height: 250px;
            }

            /* Map responsiveness */
            .map-3d-container {
                height: 400px !important;
            }

            .egypt-map {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }

            .map-region {
                padding: 0.7rem;
                font-size: 0.8rem;
            }

            .flashcard-controls {
                gap: 0.5rem;
            }

            .flashcard-btn {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }

            .features {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.8rem;
            }

            .feature {
                padding: 1rem;
            }
        }

        /* Extra small devices */
        @media (max-width: 480px) {
            header {
                padding: 0.6rem 0.8rem;
            }

            .logo {
                font-size: 0.95rem;
            }

            main {
                padding: 70px 0.8rem 1rem;
            }

            .welcome h1 {
                font-size: 1.5rem;
            }

            .welcome p {
                font-size: 0.95rem;
            }

            /* Map sidebar mobile layout - position ABOVE map, not over it */
            .map-sidebar-responsive {
                position: relative !important;
                right: auto !important;
                top: auto !important;
                bottom: auto !important;
                width: 100% !important;
                max-width: 100% !important;
                height: auto !important;
                max-height: 180px !important;
                flex-direction: row !important;
                flex-wrap: wrap !important;
                justify-content: center !important;
                margin-bottom: 10px;
                border-radius: 12px !important;
                font-size: 0.75rem;
                padding: 8px !important;
                gap: 6px !important;
            }

            .map-sidebar-responsive .btn-glow {
                font-size: 0.7rem !important;
                padding: 6px 10px !important;
                flex: 0 0 auto;
                width: auto !important;
            }

            .map-3d-container {
                height: 300px !important;
            }

            .flashcard {
                height: 220px;
                max-width: 100%;
            }

            .flashcard-front h3,
            .flashcard-back p {
                font-size: 1rem;
            }

            .flashcard-front,
            .flashcard-back {
                padding: 1rem;
            }

            .features {
                grid-template-columns: 1fr;
            }

            .card-3d.feature {
                padding: 0.8rem;
            }

            .egypt-map {
                grid-template-columns: 1fr;
            }

            .progress-bar {
                max-width: 100%;
            }

            .card {
                padding: 1rem;
                margin: 1rem 0;
            }

            .card-title {
                font-size: 1rem;
            }
        }
    </style>
</head>

<body>
    <div class="aurora-bg"></div>
    <div class="particles-3d"></div>

    <header>
        <div style="display: flex; align-items: center; gap: 1rem;">
            <a href="../../index.html" class="back-btn">
                <i class="fas fa-arrow-right"></i> الرئيسية
            </a>
            <span class="logo holo-text">
                <i class="fas fa-globe-africa"></i> الدراسات
            </span>
        </div>
        <button class="menu-btn" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i> الدروس
        </button>
    </header>

    <div class="overlay" onclick="toggleSidebar()"></div>

    <nav class="sidebar">
        <div class="sidebar-header">
            <h3><i class="fas fa-book"></i> فهرس الدروس</h3>
            <button class="close-btn" onclick="toggleSidebar()">×</button>
        </div>
        <div class="chapter-title"><i class="fas fa-map-marked-alt"></i> الخرائط الذكية</div>
        <div class="lesson-item" onclick="showLesson(1)"><i class="fas fa-globe"></i> خرائط مصر التفاعلية 3D</div>

        <div class="chapter-title"><i class="fas fa-clipboard-check"></i> الاختبارات</div>
        <div class="lesson-item" onclick="showLesson(4)"><i class="fas fa-tasks"></i> اختبر نفسك</div>

        <div class="chapter-title"><i class="fas fa-clone"></i> بطاقات الحفظ</div>
        <div class="lesson-item" onclick="showLesson(2)"><i class="fas fa-brain"></i> بطاقات المنهج الكامل</div>
        <div class="chapter-title"><i class="fas fa-file-pdf"></i> مصادر PDF</div>
        <div class="lesson-item" onclick="showLesson(3)"><i class="fas fa-folder-open"></i> الكتب والملخصات</div>
    </nav>

    <main id="main-content"></main>

    <script src="../../scripts/ai-system.js"></script>
    <script>
        // Flashcard data from curriculum
        const allFlashcards = [
            // الثروة المعدنية
            { q: "ما المقصود بالثروة المعدنية؟", a: "هي الخامات المعدنية التي توجد في باطن الأرض وتُستغل اقتصاديًا مثل الحديد، الفوسفات، المنجنيز، الجبس، وملح الطعام.", cat: "ثروة معدنية" },

            // مصادر الطاقة
            { q: "تنقسم مصادر الطاقة إلى كم نوع؟", a: "نوعين:\nطاقة متجددة\nطاقة غير متجددة", cat: "طاقة" },
            { q: "ما الطاقة المتجددة؟", a: "طاقة لا تنفد ولا تلوث البيئة مثل: الشمس، الرياح، المياه، المد والجزر.", cat: "طاقة" },
            { q: "ما الطاقة غير المتجددة؟", a: "طاقة تنفد مع الاستخدام مثل: الفحم، البترول، الغاز الطبيعي.", cat: "طاقة" },

            // خام الحديد
            { q: "مناطق وجود خام الحديد الرئيسية في مصر؟", a: "أسوان\nالواحة البحرية\nشرق الصحراء (جنوب القصير)", cat: "حديد" },
            { q: "لماذا أُنشئ مصنع الحديد والصلب في حلوان عام 1954م؟", a: "لقربه من مناطق الاستهلاك وتوافر وسائل النقل.", cat: "حديد" },
            { q: "لماذا توقف إنتاج حديد أسوان عام 1979م؟", a: "انخفاض نسبة الحديد\nارتفاع نسبة الشوائب\nزيادة استهلاك الطاقة\nنضوب جزء كبير من الاحتياطي", cat: "حديد" },
            { q: "لماذا اتجهت الدولة لاستغلال حديد الواحة البحرية؟", a: "لضخامة الاحتياطي وسهولة النقل بعد ربطها بالسكك الحديدية والطرق.", cat: "حديد" },

            // الفوسفات
            { q: "متى بدأ تعدين الفوسفات في مصر؟", a: "عام 1908م", cat: "فوسفات" },
            { q: "أهم مناطق الفوسفات في مصر؟", a: "سفاجا\nالحمراوين\nالقصير\nحقول النيل\nأبو طرطور", cat: "فوسفات" },
            { q: "لماذا تُعد منطقة أبو طرطور مهمة؟", a: "من أكبر الكشوف التعدينية\nاحتياطي يزيد عن 700 مليون طن\nقادر على المنافسة عالميًا", cat: "فوسفات" },
            { q: "لماذا تُعد حقول النيل سهلة التعدين والنقل؟", a: "التضاريس منبسطة\nقرب الخام من السطح\nقربها من النيل والسكك الحديدية", cat: "فوسفات" },

            // الجبس وملح الطعام
            { q: "ينتمي الجبس لأي نوع من الرواسب؟", a: "الرواسب التبخيرية", cat: "جبس" },
            { q: "مم يتكون الجبس؟", a: "كبريتات الكالسيوم", cat: "جبس" },
            { q: "أين توجد أهم رواسب الجبس في مصر؟", a: "خليج السويس\nالبحر الأحمر\nغرب قناة السويس\nشمال الإسماعيلية\nغرب الإسكندرية\nبحيرة المنزلة", cat: "جبس" },
            { q: "لماذا اهتمت الدولة بملح الطعام قديمًا؟", a: "لأنه كان محتكرًا للحكومة ومصدرًا مهمًا للضرائب.", cat: "ملح" },

            // النقل
            { q: "لماذا النقل مهم للتقدم الاقتصادي؟", a: "لأنه يربط مناطق الإنتاج بالاستهلاك ويسهّل التبادل التجاري.", cat: "نقل" },
            { q: "أنواع النقل في مصر؟", a: "نقل نهري\nنقل بري\nنقل بحري\nنقل جوي", cat: "نقل" },

            // مقارنات
            { q: "قارن بين الطاقة المتجددة وغير المتجددة (ميزة واحدة).", a: "المتجددة: لا تنفد ولا تلوث\nغير المتجددة: أكثر استقرارًا وسهلة النقل", cat: "مقارنة" },
            { q: "من سلبيات الوقود الأحفوري؟", a: "يلوث البيئة\nمحدود الكمية\nمكلف في الاستخراج والنقل", cat: "مقارنة" },

            // --- إضافات جديدة ---
            // الدرس الأول: التوزيع الجغرافي للمعادن
            { q: "إلى كم منطقة يُقسم توزيع المعادن في مصر؟", a: "ثلاث مناطق طولية من الشمال إلى الجنوب.", cat: "توزيع المعادن" },
            { q: "ما خصائص المنطقة الأولى (الجبلية الساحلية)؟", a: "تعدينها باطني وصعب\nيسهل النقل لقربها من الموانئ\nتشمل: سيناء – خليج السويس – الصحراء الشرقية", cat: "توزيع المعادن" },
            { q: "ما خصائص المنطقة الثانية (السهلية النهرية)؟", a: "تعدينها سطحي وسهل\nقريبة من النيل والسكك الحديدية\nتمتد حول نهر النيل حتى البحر المتوسط", cat: "توزيع المعادن" },
            { q: "ما خصائص المنطقة الثالثة (الصحراوية)؟", a: "بعيدة ومنعزلة\nصعبة التعدين والنقل\nتشمل الصحراء الغربية", cat: "توزيع المعادن" },

            // الدرس الثاني: الحديد الخام
            { q: "ما مناطق وجود خام الحديد الرئيسية في مصر؟", a: "شمال شرق أسوان\nالواحات البحرية\nساحل البحر الأحمر", cat: "حديد" },
            { q: "نوع خام الحديد في أسوان؟", a: "هيماتيت حبيبي – نسبة المعدن 52%.", cat: "حديد" },
            { q: "لماذا توقف استغلال حديد أسوان؟", a: "ارتفاع الشوائب\nانخفاض نسبة المعدن\nعدم كفاءته مع توسع مصنع الحديد والصلب", cat: "حديد" },
            { q: "ما الخدمات التي قدمتها الدولة للواحات البحرية؟", a: "خط سكة حديد\nطريق سيارات\nكهرباء\nإنشاء مدينة الجديدة", cat: "حديد" },

            // الدرس الثالث: الفوسفات والمنجنيز
            { q: "متى بدأ إنتاج الفوسفات في مصر؟", a: "بداية القرن العشرين (1908م).", cat: "فوسفات" },
            { q: "ما مناطق الفوسفات الرئيسية في مصر؟", a: "البحر الأحمر\nوادي النيل\nأبو طرطور", cat: "فوسفات" },
            { q: "لماذا تُعد منطقة أبو طرطور مهمة؟", a: "احتياطي ضخم\nإنتاج كبير\nقادرة على المنافسة عالميًا", cat: "فوسفات" },
            { q: "أين توجد مناجم المنجنيز؟", a: "أم بجمة في سيناء.", cat: "منجنيز" },

            // الدرس الرابع: الجبس وملح الطعام
            { q: "ينتمي الجبس لأي نوع من الرواسب؟", a: "الرواسب التبخيرية.", cat: "جبس" },
            { q: "أين توجد أهم مناطق الجبس في مصر؟", a: "غرب سيناء\nغرب قناة السويس\nغرب الإسكندرية", cat: "جبس" },
            { q: "أهمية الجبس الاقتصادية؟", a: "البناء والتشييد\nالزراعة\nصناعة الأسمنت\nالأغراض الطبية", cat: "جبس" },
            { q: "كيف يُنتج ملح الطعام؟", a: "بالتبخير الطبيعي ثم التبلور.", cat: "ملح" },

            // الدرس الخامس: مصادر الطاقة
            { q: "أقسام مصادر الطاقة في مصر؟", a: "طاقة متجددة\nطاقة غير متجددة", cat: "طاقة" },
            { q: "أمثلة للطاقة المتجددة؟", a: "الشمس – الرياح – المياه – المد والجزر – الطاقة الحيوية.", cat: "طاقة" },
            { q: "أمثلة للطاقة غير المتجددة؟", a: "الفحم – البترول – الغاز الطبيعي.", cat: "طاقة" },

            // الدرس السادس: البترول
            { q: "أين تتركز حقول البترول في مصر؟", a: "خليج السويس\nالصحراء الغربية\nدلتا النيل (غاز طبيعي)", cat: "بترول" },
            { q: "لماذا يُعد البترول مهمًا اقتصاديًا؟", a: "من أهم الصادرات ويُعرف بالذهب الأسود.", cat: "بترول" },

            // الدرس السابع: الغاز الطبيعي
            { q: "الفرق بين الغاز المصاحب وغير المصاحب؟", a: "مصاحب: مع البترول\nغير مصاحب: غاز فقط", cat: "غاز طبيعي" },
            { q: "استخدامات الغاز الطبيعي؟", a: "توليد الكهرباء\nالمنازل\nالصناعات\nوقود للمواصلات", cat: "غاز طبيعي" },

            // الدرس الثامن: الفحم والكهرباء
            { q: "لماذا تُعد الكهرباء طاقة الطاقات؟", a: "لأن كل مصادر الطاقة تتحول إليها.", cat: "كهرباء" },
            { q: "أنواع الكهرباء في مصر؟", a: "حرارية\nمائية\nنووية (قيد التنفيذ)", cat: "كهرباء" },

            // الدرس التاسع: النقل البري والمائي
            { q: "أنواع النقل في مصر؟", a: "بري\nمائي\nجوي", cat: "نقل" },
            { q: "أهمية السكك الحديدية؟", a: "نقل البضائع الثقيلة\nرخيصة التكلفة", cat: "نقل" },

            // الدرس العاشر: النقل الجوي
            { q: "مكانة مصر في النقل الجوي؟", a: "رائدة في الشرق الأوسط.", cat: "نقل جوي" },
            { q: "من أهم المطارات المصرية؟", a: "القاهرة – الإسكندرية – الغردقة – شرم الشيخ – الأقصر – أسوان.", cat: "نقل جوي" },

            // --- إضافات المجموعة الثالثة ---
            // الدرس الأول: التوزيع الجغرافي
            { q: "ما هي المناطق الرئيسية لتوزيع المعادن في مصر؟", a: "المنطقة الأولى: سيناء وحوض خليج السويس\nالمنطقة الثانية: وسط البلاد حول النيل\nالمنطقة الثالثة: الصحراء الغربية", cat: "توزيع المعادن" },
            { q: "ما هو أهم معدن في منطقة سيناء وحوض خليج السويس؟", a: "خام الحديد.", cat: "توزيع المعادن" },

            // الدرس الثاني: خام الحديد
            { q: "أين توجد أهم مناطق خام الحديد في مصر؟", a: "حديد أسوان\nالواحة البحرية\nساحل البحر الأحمر", cat: "حديد" },
            { q: "ماذا حدث لمصنع حديد أسوان؟", a: "توقف الإنتاج بسبب انخفاض جودة الخام وزيادة تكاليف الطاقة.", cat: "حديد" },

            // الدرس الثالث: الفوسفات والمنجنيز
            { q: "متى بدأ استخراج الفوسفات في مصر؟", a: "بدأ في 1908، وتم استخراج الفوسفات من عدة مناطق مثل سفاجا والحمراوين.", cat: "فوسفات" },
            { q: "أين يتم استخراج المنجنيز في مصر؟", a: "في سيناء والبحر الأحمر.", cat: "منجنيز" },

            // الدرس الرابع: الجبس وملح الطعام
            { q: "أين توجد أهم مناطق استخراج الجبس في مصر؟", a: "خليج السويس\nغرب قناة السويس\nالإسكندرية", cat: "جبس" },
            { q: "كيف يتم استخراج ملح الطعام في مصر؟", a: "يتم استخراج ملح الطعام باستخدام عملية التبخير الطبيعي.", cat: "ملح" },

            // الدرس الخامس: مصادر الطاقة
            { q: "ما هي أهم مصادر الطاقة المتجددة في مصر؟", a: "الطاقة الشمسية\nالرياح\nالطاقة المائية", cat: "طاقة" },
            { q: "ما هي الطاقة غير المتجددة؟", a: "الفحم\nالنفط\nالغاز الطبيعي", cat: "طاقة" },

            // الدرس السادس: البترول
            { q: "ما هي مناطق البترول الرئيسية في مصر؟", a: "خليج السويس\nالصحراء الغربية\nالبحر المتوسط", cat: "بترول" },
            { q: "كيف يتم تكرير البترول في مصر؟", a: "يتم التكرير في تسعة معامل تكرير، وأكثرها شهرة في البحر الأحمر.", cat: "بترول" },

            // الدرس السابع: الغاز الطبيعي
            { q: "ما هي أهم حقول الغاز الطبيعي في مصر؟", a: "حقل أبو ماضي\nحقل أبو قير\nحقل ظهر", cat: "غاز طبيعي" },
            { q: "ما هي أهمية الغاز الطبيعي؟", a: "يستخدم في توليد الكهرباء، الوقود للمنازل، والصناعات المختلفة.", cat: "غاز طبيعي" },

            // الدرس الثامن: الفحم والكهرباء
            { q: "ما هي مصادر توليد الكهرباء في مصر؟", a: "الفحم\nالغاز الطبيعي\nالطاقة الكهرومائية\nالطاقة النووية", cat: "كهرباء" },

            // الدرس التاسع: النقل
            { q: "ما هي أنواع النقل في مصر؟", a: "النقل البري\nالنقل المائي\nالنقل الجوي\nالنقل السككي", cat: "نقل" },
            { q: "لماذا يعتبر النقل السككي مهمًا في مصر؟", a: "لأنه يُستخدم لنقل البضائع الثقيلة، ويتميز بتكلفته المنخفضة.", cat: "نقل" },

            // الدرس العاشر: التجارة الخارجية
            { q: "ما هي الصادرات الرئيسية في مصر؟", a: "النفط\nالغاز الطبيعي\nمنتجات زراعية", cat: "تجارة" },
            { q: "ما هي واردات مصر؟", a: "الآلات\nالمعدات الصناعية\nالسيارات", cat: "تجارة" },

            // --- إضافات المجموعة الرابعة ---
            // الدرس الأول: التوزيع الجغرافي
            { q: "ما هي مناطق المعادن الرئيسية في مصر؟", a: "المنطقة الأولى: سيناء وخليج السويس.\nالمنطقة الثانية: وسط مصر حول النيل.\nالمنطقة الثالثة: الصحراء الغربية.", cat: "توزيع المعادن" },
            { q: "أين توجد أكبر مناطق الحديد في مصر؟", a: "أسوان، الواحة البحرية، ساحل البحر الأحمر.", cat: "توزيع المعادن" },
            { q: "ما هو معدن الفوسفات؟", a: "معدن يستخدم في الصناعات المختلفة مثل الأسمدة ويُستخرج من مناطق سفاجا، الحمراوين، أبو طرطور.", cat: "توزيع المعادن" },
            { q: "ما هي المعادن الموجودة في منطقة سيناء؟", a: "منجنيز\nفحم\nحديد", cat: "توزيع المعادن" },

            // الدرس الثاني: الحديد الخام
            { q: "ما هو خام الحديد في أسوان؟", a: "يُستخرج من أسوان ويتميز بجودة منخفضة وصعب التكرير.", cat: "حديد" },
            { q: "ما هو دور مصنع الحديد في حلوان؟", a: "تم إنشاء المصنع لتوفير احتياج البلاد من الحديد ولكنه توقف بعد مشاكل في خام أسوان.", cat: "حديد" },
            { q: "لماذا تتجه الدولة لاستخراج الحديد من الواحة البحرية؟", a: "بسبب احتياطي الخام الضخم وسهولة النقل.", cat: "حديد" },
            { q: "ما هو الفرق بين خام الحديد في أسوان وفي الواحة البحرية؟", a: "خام أسوان يحتوي على شوائب كثيرة، بينما خام الواحة البحرية ذو جودة أفضل.", cat: "حديد" },

            // الدرس الثالث: الفوسفات والمنجنيز
            { q: "ما هي أهم استخدامات الفوسفات؟", a: "يستخدم بشكل رئيسي في صناعة الأسمدة.", cat: "فوسفات" },
            { q: "أين توجد مناجم المنجنيز في مصر؟", a: "في أم بجمة في سيناء.", cat: "منجنيز" },
            { q: "ما أهمية منطقة أبو طرطور في الفوسفات؟", a: "تعتبر أكبر مصدر للفوسفات في مصر، ويبلغ احتياطيها أكثر من 700 مليون طن.", cat: "فوسفات" },
            { q: "كيف يتم استخراج الفوسفات؟", a: "عن طريق التعدين السطحي.", cat: "فوسفات" },

            // الدرس الرابع: الجبس وملح الطعام
            { q: "ما هو الجبس؟", a: "معدن يتكون من كبريتات الكالسيوم ويستخدم في البناء والزراعة.", cat: "جبس" },
            { q: "أين توجد مناجم الجبس في مصر؟", a: "في مناطق مثل خليج السويس، البحر الأحمر، الإسكندرية.", cat: "جبس" },
            { q: "ما هو ملح الطعام؟", a: "مادة يتم استخراجها من البحار وتستخدم في الطعام والصناعة.", cat: "ملح" },
            { q: "كيف يتم استخراج ملح الطعام؟", a: "عن طريق التبخير الطبيعي للمياه المالحة.", cat: "ملح" },

            // الدرس الخامس: مصادر الطاقة
            { q: "ما هي مصادر الطاقة المتجددة؟", a: "الطاقة الشمسية\nالرياح\nالمد والجزر\nالطاقة الحيوية", cat: "طاقة" },
            { q: "ما هي مصادر الطاقة غير المتجددة؟", a: "الفحم\nالغاز الطبيعي\nالنفط", cat: "طاقة" },
            { q: "أين توجد محطات توليد الطاقة الشمسية في مصر؟", a: "في أسوان، حيث يتم استغلال الطاقة الشمسية بشكل كبير.", cat: "طاقة" },
            { q: "ما هي مزايا الطاقة المتجددة؟", a: "لا تنفد، لا تلوث البيئة، توفر مصادر طاقة مستدامة.", cat: "طاقة" },

            // الدرس السادس: البترول
            { q: "ما هو تعريف البترول؟", a: "خليط معقد من الهيدروكربونات يُستخرج من باطن الأرض.", cat: "بترول" },
            { q: "أين توجد حقول البترول الرئيسية في مصر؟", a: "خليج السويس\nالبحر المتوسط\nالصحراء الغربية", cat: "بترول" },
            { q: "كيف يتم تكرير البترول؟", a: "عبر عمليات في معامل التكرير لفصل المكونات المختلفة مثل البنزين، السولار، والمازوت.", cat: "بترول" },
            { q: "ما هي أهمية البترول للاقتصاد المصري؟", a: "يعتبر من أهم مصادر الدخل القومي من خلال الصادرات واستخداماته المحلية في الصناعة.", cat: "بترول" },

            // الدرس السابع: الغاز الطبيعي
            { q: "ما هو الغاز الطبيعي؟", a: "غاز هيدروكربوني يُستخرج من باطن الأرض ويستخدم في توليد الكهرباء وتدفئة المنازل.", cat: "غاز طبيعي" },
            { q: "ما هي أهم حقول الغاز الطبيعي في مصر؟", a: "حقل ظهر\nحقل أبو ماضي\nحقل أبو قير", cat: "غاز طبيعي" },
            { q: "كيف يتم استخراج الغاز الطبيعي؟", a: "يتم من خلال حفر آبار في المناطق الغازية، ثم يتم نقله عبر خطوط أنابيب.", cat: "غاز طبيعي" },
            { q: "ما هي استخدامات الغاز الطبيعي؟", a: "يستخدم في توليد الكهرباء، الوقود للمنازل، والصناعات.", cat: "غاز طبيعي" },

            // الدرس الثامن: الفحم
            { q: "ما هو الفحم؟", a: "هو مادة صلبة تحتوي على كربون، تُستخدم في توليد الكهرباء والحرارة.", cat: "فحم" },
            { q: "كيف يتم استخدام الفحم في مصر؟", a: "يُستخدم في محطات توليد الكهرباء وبعض الصناعات.", cat: "فحم" },
            { q: "أين توجد مناجم الفحم في مصر؟", a: "في مناطق مثل المغارة في سيناء.", cat: "فحم" },
            { q: "ما هي مصادر توليد الكهرباء في مصر؟", a: "الفحم\nالغاز الطبيعي\nالطاقة الكهرومائية\nالطاقة النووية", cat: "كهرباء" },

            // الدرس التاسع: النقل
            { q: "ما هي أنواع النقل في مصر؟", a: "النقل البري\nالنقل السككي\nالنقل المائي\nالنقل الجوي", cat: "نقل" },
            { q: "ما هي أهمية السكك الحديدية؟", a: "تعتبر من وسائل النقل الرئيسية لنقل البضائع الثقيلة بتكلفة منخفضة.", cat: "نقل" },
            { q: "ما هي أهمية قناة السويس؟", a: "تعتبر من أهم ممرات الملاحة البحرية في العالم، حيث تربط البحر الأبيض المتوسط بالبحر الأحمر.", cat: "نقل" },
            { q: "ما هو النقل الجوي في مصر؟", a: "يشمل حركة الطائرات من وإلى مختلف المطارات المصرية مثل مطار القاهرة الدولي.", cat: "نقل" },

            // الدرس العاشر: التجارة الخارجية
            { q: "ما هو تعريف الميزان التجاري؟", a: "هو الفرق بين الصادرات والواردات من السلع والخدمات.", cat: "تجارة" },
            { q: "ما هي الصادرات الرئيسية لمصر؟", a: "النفط\nالغاز الطبيعي\nالمنتجات الزراعية", cat: "تجارة" },
            { q: "ما هي واردات مصر؟", a: "الآلات\nالسيارات\nالمواد الخام", cat: "تجارة" },
            { q: "ما هو الفائض التجاري؟", a: "عندما تتجاوز الصادرات الواردات.", cat: "تجارة" }
        ];

        let currentCard = 0;
        let correctCount = 0;
        let wrongCount = 0;
        let cardStatus = new Array(allFlashcards.length).fill(0);

        // Quiz Variables
        let quizScore = 0;
        let quizWrong = 0;
        let quizIndex = 0;
        let quizUserAnswers = [];
        let isQuizActive = false;
        let reviewList = [];
        let reviewIndex = 0;

        function getWelcomeHTML() {
            return `
            <div class="welcome reveal">
                <h1 class="holo-text"><i class="fas fa-globe-africa"></i> الدراسات الاجتماعية</h1>
                <img src="../../Manhagko Logo2.png" alt="Manhagko Logo" style="width: 160px; height: 160px; border-radius: 16px; object-fit: contain; border: 3px solid var(--primary); box-shadow: 0 0 35px rgba(78,205,196,0.4), 0 8px 25px rgba(0,0,0,0.3); margin: 15px auto; display: block; background: rgba(255,255,255,0.05); padding: 8px;">
                <p style="color: var(--accent);">خرائط تفاعلية 3D + بطاقات حفظ ذكية!</p>
                <div class="features">
                    <div class="card-3d feature" onclick="showLesson(1)" style="cursor: pointer;"><i class="fas fa-map"></i><br>خرائط 3D</div>
                    <div class="card-3d feature" onclick="showLesson(2)" style="cursor: pointer;"><i class="fas fa-clone"></i><br>بطاقات حفظ</div>
                    <div class="card-3d feature" onclick="showLesson(4)" style="cursor: pointer;"><i class="fas fa-clipboard-check"></i><br>اختبر نفسك</div>
                    <div class="card-3d feature" onclick="showLesson(3)" style="cursor: pointer;"><i class="fas fa-file-pdf"></i><br>مصادر PDF</div>
                </div>
                <button class="btn-glow" onclick="toggleSidebar()">
                    <i class="fas fa-rocket"></i> ابدأ المذاكرة
                </button>
            </div>`;
        }

        function getMapsHTML() {
            // Build map buttons HTML
            const mapButtonsHTML = [
                { title: 'خريطة المعادن', idx: 0 },
                { title: 'خريطة البترول', idx: 1 },
                { title: 'خريطة الفحم', idx: 2 },
                { title: 'خريطة المنجنيز', idx: 3 },
                { title: 'خريطة الفوسفات', idx: 4 },
                { title: 'خريطة الحديد', idx: 5 },
                { title: 'خريطة الذهب', idx: 6 },
                { title: 'خريطة الجبس', idx: 7 }
            ].map(m => `<button class="btn-glow map-btn" onclick="loadMap(${m.idx})" style="padding: 8px 16px; font-size: 0.85rem;"><i class="fas fa-map"></i> ${m.title}</button>`).join('');

            return `
            <div class="lesson-header reveal">
                <h1 class="holo-text"><i class="fas fa-globe"></i> خرائط مصر التفاعلية</h1>
                <h2> اي كل الخرايط ديييي؟؟ </h2>
            </div>
            
            <div class="reveal" style="text-align: center; margin-bottom: 20px;">
                <div class="flashcard-controls" style="justify-content: center;">
                    <button class="flashcard-btn" id="mode-learn" onclick="setMapMode('learn')" style="background: var(--primary); color: #000;">
                        <i class="fas fa-book-open"></i> وضع التعلم
                    </button>
                    <button class="flashcard-btn" id="mode-train" onclick="setMapMode('train')">
                        <i class="fas fa-gamepad"></i> وضع التدريب
                    </button>
                </div>
                <div id="map-score-panel" style="display: none; margin-top: 15px; font-weight: bold; color: var(--accent);">
                    نتيجة التدريب: <span id="map-score">0</span> / <span id="map-total">0</span>
                </div>
            </div>

            <!-- Map Selection Buttons - ABOVE the map -->
            <div class="card-3d reveal map-buttons-container" style="margin-bottom: 15px; padding: 1rem;">
                <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                    ${mapButtonsHTML}
                </div>
            </div>

            <!-- Map Container - NO sidebar inside -->
            <div class="map-3d-container reveal" style="height: 500px; border-radius: 15px; overflow: hidden; border: 2px solid var(--primary);">
                <div id="map" style="width: 100%; height: 100%; direction: ltr;"></div>
            </div>
            
            <div class="card-3d reveal" style="margin-top: 20px;">
                <div class="card-title"><i class="fas fa-info-circle"></i> ذاكر الخرايط كويس </div>
                <div style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: center;">
                    
                    
                    <span style="color: #00ff88;"><i class="fas fa-bolt"></i> ربنا معاك ياصحبي</span>
                    
                </div>
            </div>`;
        }

        // Image Map Data
        const imageMaps = [
            { id: 'map1', title: 'خريطة المعادن', url: 'خرايط/WhatsApp Image 2025-05-12 at 9.17.47 PM.jpeg', points: [] },
            { id: 'map2', title: 'خريطة البترول', url: 'خرايط/WhatsApp Image 2025-05-12 at 9.17.48 PM.jpeg', points: [] },
            { id: 'map3', title: 'خريطة الفحم', url: 'خرايط/WhatsApp Image 2025-05-12 at 9.18.11 PM.jpeg', points: [] },
            { id: 'map4', title: 'خريطة المنجنيز', url: 'خرايط/WhatsApp Image 2025-05-12 at 9.18.15 PM.jpeg', points: [] },
            { id: 'map5', title: 'خريطة الفوسفات', url: 'خرايط/WhatsApp Image 2025-05-12 at 9.18.15 PM (1).jpeg', points: [] },
            { id: 'map6', title: 'خريطة الحديد', url: 'خرايط/WhatsApp Image 2025-05-12 at 9.18.16 PM.jpeg', points: [] },
            { id: 'map7', title: 'خريطة الذهب', url: 'خرايط/WhatsApp Image 2025-05-12 at 9.18.45 PM.jpeg', points: [] },
            { id: 'map8', title: 'خريطة الجبس', url: 'خرايط/WhatsApp Image 2025-05-12 at 9.18.46 PM.jpeg', points: [] }
        ];

        let currentMapIndex = 0;
        let map;
        let mapMode = 'learn';
        let mapScore = 0;

        window.initMap = function () {
            if (map) { map.remove(); }

            // Ensure we have a valid container
            const mapDiv = document.getElementById('map');
            if (!mapDiv) {
                console.error("Map element not found");
                return;
            }

            // Load the first map
            loadMap(0);
        };

        let devMode = false;
        window.toggleDevMode = function () {
            devMode = !devMode;
            Swal.fire({
                toast: true, position: 'top-end', icon: 'info',
                title: devMode ? 'لو راجل احفظ الخرايط' : ' ذاكر ذاكر ',
                timer: 3000, showConfirmButton: false
            });
        };

        window.loadMap = function (index) {
            currentMapIndex = index;
            if (map) map.remove();

            const mapData = imageMaps[index];
            const encodedUrl = encodeURIComponent(mapData.url); // ترميز أكثر أمانًا للمسافات والأحرف الخاصة (يحل مشكلة الموبايل)

            // Show loading indicator logic could be added here if needed

            // Init Leaflet with CRS.Simple
            map = L.map('map', {
                crs: L.CRS.Simple,
                minZoom: -2,
                maxZoom: 2,
                zoomControl: true,
                attributionControl: false
            });

            // Load Image
            const img = new Image();
            img.onload = function () {
                const w = this.width;
                const h = this.height;
                const bounds = [[0, 0], [h, w]];

                L.imageOverlay(encodedUrl, bounds).addTo(map);
                map.fitBounds(bounds);

                // Markers would go here
                renderMapMarkers(mapData, h);
            };

            img.onerror = function () {
                console.error("Failed to load map image:", encodedUrl);
                Swal.fire({
                    icon: 'error',
                    title: 'خطأ في تحميل الخريطة',
                    text: 'تأكد من وجود ملف الصورة: ' + mapData.url
                });
            };

            img.src = encodedUrl;

            // Dev Mode Click
            map.on('click', function (e) {
                if (devMode) {
                    const coords = `[${Math.round(e.latlng.lat)}, ${Math.round(e.latlng.lng)}]`;
                    navigator.clipboard.writeText(coords);
                    Swal.fire({
                        toast: true, position: 'top', icon: 'success',
                        title: `تم نسخ: ${coords}`,
                        text: 'جاهز للصق',
                        timer: 1000
                    });
                }
            });
        };

        window.renderMapMarkers = function (mapData, mapHeight) {
            // Render points if any
        };

        window.setMapMode = function (mode) {
            mapMode = mode;
            // Update UI buttons... (keeping existing logic roughly)
            // This part needs to be adapted to the new map system.
            // For now, just re-initialize the current map to apply mode changes.
            loadMap(currentMapIndex);
        };

        // The following functions related to the old map system are no longer needed
        // and should be removed or adapted if training mode is to be implemented for image maps.
        // For now, they are kept as placeholders or removed if they directly depend on mapLocations.

        // Removed: mapLocations array (as per instruction, replaced by imageMaps)
        // Removed: renderMap function (as per instruction, replaced by loadMap and renderMapMarkers)
        // Removed: checkMapAnswer function (as per instruction, it was tied to the old mapLocations)

        // Legacy map functions removed. 
        // Training mode for Image Maps will be re-implemented.
        // Legacy map functions removed.

        function getFlashcardsHTML() {
            return `
            <div class="lesson-header reveal">
                <h1 class="holo-text"><i class="fas fa-brain"></i> بطاقات الحفظ الذكية</h1>
                <h2>اضغط على البطاقة لرؤية الإجابة</h2>
            </div>
            
            <div class="card-3d reveal" style="text-align: center;">
                <div style="display: flex; justify-content: space-around;">
                    <div><span style="font-size: 2rem; color: var(--primary);">${allFlashcards.length}</span><br>إجمالي</div>
                    <div><span style="font-size: 2rem; color: var(--accent);" id="correctCount">0</span><br>صحيح ✓</div>
                    <div><span style="font-size: 2rem; color: var(--secondary);" id="wrongCount">0</span><br>للمراجعة</div>
                </div>
                <div class="progress-bar" style="margin-top: 1rem;">
                    <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                </div>
            </div>
            
            <div class="flashcard-container reveal">
                <p style="color: var(--text-muted);" id="cardProgress">البطاقة 1 من ${allFlashcards.length}</p>
                
                <div class="flashcard" id="flashcard" onclick="flipCard()">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <i class="fas fa-question-circle" style="font-size: 2.5rem; color: var(--primary); margin-bottom: 1rem;"></i>
                            <h3 id="question">${allFlashcards[0].q}</h3>
                            <p style="color: var(--text-muted); margin-top: 1rem; font-size: 0.9rem;">${allFlashcards[0].cat}</p>
                        </div>
                        <div class="flashcard-back">
                            <i class="fas fa-lightbulb" style="font-size: 2.5rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                            <p id="answer">${allFlashcards[0].a.replace(/\\n/g, '<br>')}</p>
                        </div>
                    </div>
                </div>
                
                <div class="flashcard-controls">
                    <button class="flashcard-btn wrong" onclick="markWrong()"><i class="fas fa-redo"></i> راجع لاحقاً</button>
                    <button class="flashcard-btn correct" onclick="markCorrect()"><i class="fas fa-check"></i> حفظتها!</button>
                </div>
                <div class="flashcard-controls">
                    <button class="flashcard-btn" onclick="prevCard()"><i class="fas fa-arrow-right"></i></button>
                    <button class="flashcard-btn" onclick="shuffleCards()"><i class="fas fa-random"></i> خلط</button>
                    <button class="flashcard-btn" onclick="nextCard()"><i class="fas fa-arrow-left"></i></button>
                </div>
            </div>`;
        }

        function getQuizHTML() {
            return `
            <div class="lesson-header reveal">
                <h1 class="holo-text"><i class="fas fa-clipboard-check"></i> اختبر نفسك</h1>
                <h2>جاوب و قيم مستواك!</h2>
            </div>
            
            <div id="quiz-container" class="flashcard-container reveal">
                <div class="card-3d" style="width: 100%; max-width: 800px; text-align: center;">
                    <div id="quiz-stats" style="display: flex; justify-content: space-between; margin-bottom: 20px; font-weight: bold;">
                        <span style="color: var(--accent);">صحيح: <span id="q-correct">0</span></span>
                        <span style="color: var(--text);">سؤال: <span id="q-current">1</span> / ${allFlashcards.length}</span>
                        <span style="color: var(--secondary);">خطأ: <span id="q-wrong">0</span></span>
                    </div>
                    
                    <div id="quiz-content">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 id="quiz-question" style="margin: 0; color: var(--primary); font-size: 1.3rem; flex-grow: 1;" dir="auto"></h3>
                            <button onclick="showQuizResult()" class="flashcard-btn wrong" style="font-size: 0.9rem; padding: 5px 10px; margin-right: 10px; white-space: nowrap;">
                                <i class="fas fa-flag-checkered"></i> إنهاء
                            </button>
                        </div>
                        <div id="quiz-options" style="display: flex; flex-direction: column; gap: 10px;"></div>
                    </div>
                    
                    <div id="quiz-result" style="display: none;">
                        <i class="fas fa-trophy" style="font-size: 4rem; color: var(--warning); margin-bottom: 20px;"></i>
                        <h2>النتيجة النهائية</h2>
                        <div class="circular-progress" id="score-circle">
                            <span class="progress-value">0%</span>
                        </div>
                        <p id="final-score-text" style="font-size: 1.2rem; margin: 20px 0;"></p>
                        <button class="btn-glow" onclick="startQuiz()">إعادة الاختبار</button>
                    </div>

                    <div id="quiz-review" style="display: none;">
                        <h2 class="holo-text" style="margin-bottom: 20px;"><i class="fas fa-eye"></i> مراجعة الأسئلة</h2>
                        <p id="review-count" style="color: var(--text-muted); margin-bottom: 15px;">سؤال 1 من X</p>
                        <h3 id="review-q" style="margin-bottom: 20px; color: var(--primary); font-size: 1.3rem;" dir="auto"></h3>
                        <div id="review-options" style="display: flex; flex-direction: column; gap: 10px;"></div>
                        <div class="flashcard-controls" style="margin-top: 20px;">
                            <button class="flashcard-btn" onclick="prevReview()"><i class="fas fa-arrow-right"></i> السابق</button>
                            <button class="flashcard-btn" onclick="exitReview()"><i class="fas fa-times"></i> إنهاء المراجعة</button>
                            <button class="flashcard-btn" onclick="nextReview()">التالي <i class="fas fa-arrow-left"></i></button>
                        </div>
                    </div>
                </div>
            </div>`;
        }

        function getPDFsHTML() {
            return `
            <div class="lesson-header reveal">
                <h1 class="holo-text"><i class="fas fa-file-pdf"></i> مصادر PDF</h1>
                <h2>الكتب والملخصات</h2>
            </div>
            
            <div class="card-3d reveal">
                <div class="card-title"><i class="fas fa-book"></i> الكتب الدراسية</div>
                <a href="مصادر PDF/الدراسات الاجتماعية.pdf" target="_blank" class="pdf-link">
                    <i class="fas fa-file-pdf"></i> كتاب الدراسات الاجتماعية
                </a>
                <a href="مصادر PDF/منهج الصف الثالث الثانوي ( المعدل.pdf" target="_blank" class="pdf-link">
                    <i class="fas fa-file-pdf"></i> المنهج المعدل ⭐
                </a>
            </div>
            
            <div class="card-3d reveal">
                <div class="card-title"><i class="fas fa-map"></i> الخرائط والملخصات</div>
                <a href="مصادر PDF/ملخص الدراسات (اهم مصدر موجز للمادة) (17 درس X  ف 17 صفحة).pdf" target="_blank" class="pdf-link">
                    <i class="fas fa-star"></i> ملخص الدراسات (17 درس × 17 صفحة) ⭐
                </a>
                <a href="مصادر PDF/مراجعة الخرائط.pdf" target="_blank" class="pdf-link">
                    <i class="fas fa-map-marked-alt"></i> مراجعة الخرائط ⭐
                </a>
                <a href="مصادر PDF/ملخص منهج الدراسات الصف الثالث.pdf" target="_blank" class="pdf-link">
                    <i class="fas fa-file-alt"></i> ملخص المنهج
                </a>
                <a href="مصادر PDF/مراجعة نهائية.pdf" target="_blank" class="pdf-link">
                    <i class="fas fa-check-circle"></i> المراجعة النهائية
                </a>
            </div>
            
            <div class="card-3d reveal">
                <div class="card-title"><i class="fas fa-question-circle"></i> بنوك الأسئلة</div>
                <a href="مصادر PDF/بنك الاسئله (1).pdf" target="_blank" class="pdf-link">
                    <i class="fas fa-tasks"></i> بنك الأسئلة
                </a>
                <a href="مصادر PDF/بنك اسئلة الوحدة الخامسة.pdf" target="_blank" class="pdf-link">
                    <i class="fas fa-tasks"></i> أسئلة الوحدة الخامسة
                </a>
                <a href="مصادر PDF/تقييم مادة الدراسات الاجتماعية للصف الثالث الثانوي.pdf" target="_blank" class="pdf-link">
                    <i class="fas fa-clipboard-check"></i> تقييم المادة
                </a>
            </div>

            <div class="card-3d reveal">
                <div class="card-title"><i class="fab fa-youtube"></i> قنوات يوتيوب</div>
                <a href="https://www.youtube.com/@mohegamal9392" target="_blank" class="pdf-link" style="border-color: var(--warning); color: var(--warning);">
                    <i class="fab fa-youtube"></i> أ / مهى جمال
                </a>
                <a href="https://youtu.be/yIHE10U7YyU?si=pMLejLWNOTsU4QS-" target="_blank" class="pdf-link" style="border-color: var(--warning); color: var(--warning);">
                    <i class="fab fa-youtube"></i> مس روزيتا
                </a>
            </div>`;
        }

        // Card functions
        window.flipCard = function () {
            document.getElementById('flashcard').classList.toggle('flipped');
        };

        window.updateCard = function () {
            const card = allFlashcards[currentCard];
            document.getElementById('question').textContent = card.q;
            document.getElementById('answer').innerHTML = card.a.replace(/\\n/g, '<br>');
            document.getElementById('cardProgress').textContent = `البطاقة ${currentCard + 1} من ${allFlashcards.length} (${card.cat})`;
            document.getElementById('flashcard').classList.remove('flipped');
            updateProgress();
        };

        window.updateProgress = function () {
            const done = cardStatus.filter(s => s !== 0).length;
            const pct = (done / allFlashcards.length) * 100;
            document.getElementById('progressFill').style.width = pct + '%';
        };

        window.nextCard = function () {
            currentCard = (currentCard + 1) % allFlashcards.length;
            updateCard();
        };

        window.prevCard = function () {
            currentCard = (currentCard - 1 + allFlashcards.length) % allFlashcards.length;
            updateCard();
        };

        window.markCorrect = function () {
            if (cardStatus[currentCard] !== 1) {
                if (cardStatus[currentCard] === -1) wrongCount--;
                cardStatus[currentCard] = 1;
                correctCount++;
                document.getElementById('correctCount').textContent = correctCount;
                document.getElementById('wrongCount').textContent = wrongCount;
            }
            nextCard();
        };

        window.markWrong = function () {
            if (cardStatus[currentCard] !== -1) {
                if (cardStatus[currentCard] === 1) correctCount--;
                cardStatus[currentCard] = -1;
                wrongCount++;
                document.getElementById('correctCount').textContent = correctCount;
                document.getElementById('wrongCount').textContent = wrongCount;
            }
            nextCard();
        };

        window.shuffleCards = function () {
            for (let i = allFlashcards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allFlashcards[i], allFlashcards[j]] = [allFlashcards[j], allFlashcards[i]];
                [cardStatus[i], cardStatus[j]] = [cardStatus[j], cardStatus[i]];
            }
            currentCard = 0;
            updateCard();
        };

        function showLesson(num) {
            const main = document.getElementById('main-content');
            let content = '';
            switch (num) {
                case 1:
                    content = getMapsHTML();
                    setTimeout(initMap, 200);
                    break;
                case 2: content = getFlashcardsHTML(); break;
                case 3: content = getPDFsHTML(); break;
                case 4:
                    content = getQuizHTML();
                    setTimeout(startQuiz, 100);
                    break;
                default: content = getWelcomeHTML();
            }
            main.innerHTML = content;
            toggleSidebar();
            initReveal();
        }

        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('active');
            document.querySelector('.overlay').classList.toggle('active');
        }

        function initReveal() {
            const reveals = document.querySelectorAll('.reveal');
            reveals.forEach((el, i) => {
                setTimeout(() => el.classList.add('active'), i * 100);
            });
        }

        // Create particles

        // Quiz Logic
        window.startQuiz = function () {
            quizScore = 0;
            quizWrong = 0;
            quizIndex = 0;
            quizUserAnswers = [];
            isQuizActive = true;

            document.getElementById('quiz-content').style.display = 'block';
            document.getElementById('quiz-result').style.display = 'none';
            document.getElementById('quiz-review').style.display = 'none';
            document.getElementById('quiz-stats').style.display = 'flex';
            updateQuizStats();
            loadQuizQuestion();
        };

        window.updateQuizStats = function () {
            document.getElementById('q-correct').textContent = quizScore;
            document.getElementById('q-wrong').textContent = quizWrong;
            document.getElementById('q-current').textContent = quizIndex + 1;
        };

        window.loadQuizQuestion = function () {
            if (quizIndex >= allFlashcards.length) {
                showQuizResult();
                return;
            }

            const card = allFlashcards[quizIndex];
            const qEl = document.getElementById('quiz-question');
            const optsEl = document.getElementById('quiz-options');

            qEl.textContent = card.q;
            optsEl.innerHTML = '';

            // Since we don't have structured options in social studies, we use the manual self-assessment method
            optsEl.innerHTML = `<button class="btn-glow" onclick="showAnswer()">إظهار الإجابة (قيم نفسك يدوياً)</button>
                                 <div style="margin-top:10px; display:flex; gap:10px; justify-content:center;">
                                    <button class="flashcard-btn correct" onclick="handleManualResult(true)">صح</button>
                                    <button class="flashcard-btn wrong" onclick="handleManualResult(false)">خطأ</button>
                                 </div>`;

            updateQuizStats();
        };

        window.showAnswer = function () {
            const card = allFlashcards[quizIndex];
            Swal.fire({
                title: 'الإجابة النموذجية',
                html: `<div style="text-align: right; font-size: 1.1rem; line-height: 1.6;">${card.a.replace(/\n/g, '<br>')}</div>`,
                icon: 'info',
                confirmButtonText: 'حسناً',
                background: '#0a0a1a',
                color: '#fff',
                confirmButtonColor: 'var(--primary)'
            });
        };

        window.handleManualResult = function (isCorrect) {
            if (isCorrect) {
                quizScore++;
                Swal.fire({
                    position: 'top-end', icon: 'success', title: 'إجابة صحيحة!',
                    showConfirmButton: false, timer: 1000, background: '#0a0a1a', color: '#fff'
                });
            } else {
                quizWrong++;
                Swal.fire({
                    position: 'top-end', icon: 'error', title: 'إجابة خاطئة!',
                    showConfirmButton: false, timer: 1000, background: '#0a0a1a', color: '#fff'
                });
            }

            quizUserAnswers.push({
                cardIndex: quizIndex,
                userOptIdx: isCorrect ? -2 : -3, // -2 manual correct, -3 manual wrong
                isCorrect: isCorrect
            });

            quizIndex++;
            loadQuizQuestion();
        };

        window.showQuizResult = function () {
            document.getElementById('quiz-content').style.display = 'none';
            document.getElementById('quiz-result').style.display = 'block';
            document.getElementById('quiz-stats').style.display = 'none';

            const total = quizIndex; // Use quizIndex instead of total length as user might finish early
            const percentage = total > 0 ? Math.round((quizScore / total) * 100) : 0;

            document.querySelector('.progress-value').textContent = `${percentage}%`;
            document.getElementById('final-score-text').innerHTML = `
                جاوبت <b>${quizScore}</b> صح و <b>${quizWrong}</b> غلط <br> من أصل ${total} سؤال تم حله.
                <br><br>
                ${percentage >= 50 ? '<span style="color:var(--accent)">مستوى ممتاز! استمر يا بطل 🚀</span>' : '<span style="color:var(--secondary)">محتاج مراجعة شوية، جرب تاني! 💪</span>'}
                <br><br>
                <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
                    <button class="flashcard-btn correct" onclick="startReview('correct')"><i class="fas fa-check"></i> مراجعة الإجابات الصحيحة</button>
                    <button class="flashcard-btn wrong" onclick="startReview('wrong')"><i class="fas fa-times"></i> مراجعة الإجابات الخاطئة</button>
                    <button class="flashcard-btn" onclick="startReview('all')"><i class="fas fa-list"></i> مراجعة الكل</button>
                </div>
            `;

            document.getElementById('score-circle').style.background = `conic-gradient(var(--primary) ${percentage * 3.6}deg, rgba(255,255,255,0.1) 0deg)`;
        };

        // Review System
        window.startReview = function (filter) {
            reviewList = quizUserAnswers.filter(ans => {
                if (filter === 'correct') return ans.isCorrect;
                if (filter === 'wrong') return !ans.isCorrect;
                return true;
            });

            if (reviewList.length === 0) {
                Swal.fire({ icon: 'info', title: 'لا يوجد أسئلة', text: 'لا توجد أسئلة في هذا القسم.', background: '#0a0a1a', color: '#fff' });
                return;
            }

            reviewIndex = 0;
            document.getElementById('quiz-result').style.display = 'none';
            document.getElementById('quiz-review').style.display = 'block';
            loadReviewCard();
        };

        window.loadReviewCard = function () {
            const answerData = reviewList[reviewIndex];
            const card = allFlashcards[answerData.cardIndex];

            document.getElementById('review-count').textContent = `سؤال ${reviewIndex + 1} من ${reviewList.length}`;
            document.getElementById('review-q').textContent = card.q;

            const optsEl = document.getElementById('review-options');
            optsEl.innerHTML = `<div class="card" style="text-align:center;">
                <p style="color:var(--text-muted)">الإجابة الصحيحة:</p>
                <p style="color:var(--accent); font-size:1.2rem;">${card.a.replace(/\\n/g, '<br>')}</p>
                <hr style="border-color:rgba(255,255,255,0.1); margin:10px 0;">
                <p style="color:${answerData.isCorrect ? 'var(--accent)' : 'var(--secondary)'}">
                    ${answerData.isCorrect ? 'إجابتك صحيحة' : 'إجابتك خاطئة'}
                </p>
             </div>`;
        };

        window.nextReview = function () {
            if (reviewIndex < reviewList.length - 1) {
                reviewIndex++;
                loadReviewCard();
            }
        };

        window.prevReview = function () {
            if (reviewIndex > 0) {
                reviewIndex--;
                loadReviewCard();
            }
        };

        window.exitReview = function () {
            document.getElementById('quiz-review').style.display = 'none';
            document.getElementById('quiz-result').style.display = 'block';
        };

        function createParticles() {
            const container = document.querySelector('.particles-3d');
            if (!container) return;
            for (let i = 0; i < 20; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = Math.random() * 100 + '%';
                p.style.animationDuration = (15 + Math.random() * 20) + 's';
                p.style.animationDelay = Math.random() * 20 + 's';
                container.appendChild(p);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('main-content').innerHTML = getWelcomeHTML();
            createParticles();
            initReveal();
        });
    </script>
</body>

</html>
